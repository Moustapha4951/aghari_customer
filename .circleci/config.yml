version: 2.1
jobs:
  build-ios:
    macos:
      xcode: "15.2.0"
    steps:
      - checkout
      - run:
          name: Install CocoaPods
          command: sudo gem install cocoapods
      - run:
          name: Install Flutter
          command: |
            git clone https://github.com/flutter/flutter.git --depth 1 -b stable
            export PATH="$PATH:`pwd`/flutter/bin"
      - run:
          name: Install Dart and Flutter dependencies
          command: |
            export PATH="$PATH:`pwd`/flutter/bin"
            cd aghari_customer
            flutter pub get
      - run:
          name: Install CocoaPods dependencies
          command: |
            cd aghari_customer/ios
            pod install
            cd ../..
      - run:
          name: Export development_id as DEVELOPMENT_TEAM and build
          command: |
            export PATH="$PATH:`pwd`/flutter/bin"
            export DEVELOPMENT_TEAM="$development_id"
            xcodebuild -workspace aghari_customer/ios/Runner.xcworkspace -scheme Runner -sdk iphoneos -configuration Release clean archive -archivePath aghari_customer/ios/build/Runner.xcarchive DEVELOPMENT_TEAM=$DEVELOPMENT_TEAM
workflows:
  version: 2
  build:
    jobs:
      - build-ios